ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 ;;
                              2 ;; ENTITY MANAGER
                              3 ;;
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                              4 .include "entity_manager.h.s"
                              1 ;;
                              2 ;;CABECERA DE ENTITYMANAGER
                              3 ;;
                              4 .globl entityman_getEntityVector_IX
                              5 .globl entityman_getNumEntities_A
                              6 .globl entityman_create
                              7 .globl man_entity_new
                              8 .globl man_entity_init
                              9 
                             10 ;;Macro creacion de entidades
                             11 .macro DefineEntityAnnonimous _x, _y, _vx, _vy, _w, _h, _color
                             12    
                             13    .db _x
                             14    .db _y
                             15    .db _vx
                             16    .db _vy
                             17    .db _w
                             18    .db _h
                             19    .db _color
                             20    
                             21 .endm
                             22 
                             23 .macro DefineEntity _name, _x, _y, _vx, _vy, _w, _h, _color
                             24     _name::
                             25         DefineEntityAnnonimous
                             26 .endm
                             27 
                             28 .macro DefineEntityArray _name, _N
                             29     _name::
                             30         .rept _N
                             31             DefineEntityAnnonimous 0xDE, 0xAD, 0xDE, 0xAD, 0xDE, 0xAD, 0xAA
                             32         .endm
                             33 .endm
                             34 
                     0000    35 e_x = 0
                     0001    36 e_y = 1
                     0002    37 e_w = 2
                     0003    38 e_h = 3
                     0004    39 e_vx = 4
                     0005    40 e_vy = 5
                     0006    41 e_col = 6
                     0007    42 sizeof_e = 7
                             43 
                             44 ;;
                             45 ;;CONSTANTES
                             46 ;;Estas no se si estan bien. Fran no las incluye en el video
                             47 .globl _num_entities
                             48 .globl _entity_array
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



                              5 
                     0003     6 max_entities == 3
                              7 
   0000 00                    8 _num_entities::  .db 0
   0001 03 00                 9 _last_elem_ptr:: .dw _entity_array
                             10 
   0003                      11 DefineEntityArray _entity_array, max_entities
   0003                       1     _entity_array::
                              2         .rept max_entities
                              3             DefineEntityAnnonimous 0xDE, 0xAD, 0xDE, 0xAD, 0xDE, 0xAD, 0xAA
                              4         .endm
   0003                       1             DefineEntityAnnonimous 0xDE, 0xAD, 0xDE, 0xAD, 0xDE, 0xAD, 0xAA
                              1    
   0003 DE                    2    .db 0xDE
   0004 AD                    3    .db 0xAD
   0005 DE                    4    .db 0xDE
   0006 AD                    5    .db 0xAD
   0007 DE                    6    .db 0xDE
   0008 AD                    7    .db 0xAD
   0009 AA                    8    .db 0xAA
                              9    
   000A                       1             DefineEntityAnnonimous 0xDE, 0xAD, 0xDE, 0xAD, 0xDE, 0xAD, 0xAA
                              1    
   000A DE                    2    .db 0xDE
   000B AD                    3    .db 0xAD
   000C DE                    4    .db 0xDE
   000D AD                    5    .db 0xAD
   000E DE                    6    .db 0xDE
   000F AD                    7    .db 0xAD
   0010 AA                    8    .db 0xAA
                              9    
   0011                       1             DefineEntityAnnonimous 0xDE, 0xAD, 0xDE, 0xAD, 0xDE, 0xAD, 0xAA
                              1    
   0011 DE                    2    .db 0xDE
   0012 AD                    3    .db 0xAD
   0013 DE                    4    .db 0xDE
   0014 AD                    5    .db 0xAD
   0015 DE                    6    .db 0xDE
   0016 AD                    7    .db 0xAD
   0017 AA                    8    .db 0xAA
                              9    
                             12 
                             13 ;;DefineComponentArrayStructure _entity, max_entities, Definecmp_EntityDefault
                             14 
   0018                      15 entityman_getEntityVector_IX::
                             16 
   0018 DD 21 03 00   [14]   17     ld ix, #_entity_array
   001C C9            [10]   18 ret
                             19 
   001D                      20 entityman_getNumEntities_A::
   001D 3A 00 00      [13]   21     ld a, (_num_entities)
   0020 C9            [10]   22 ret
                             23 
   0021                      24 man_entity_getArray::
   0021 DD 21 03 00   [14]   25     ld ix, #_entity_array
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



   0025 3A 00 00      [13]   26     ld a, (_num_entities)
                             27 
   0028 C9            [10]   28 ret
                             29 
   0029                      30 man_entity_init::
   0029 AF            [ 4]   31     xor a
   002A 32 00 00      [13]   32     ld (_num_entities), a
                             33     
   002D 21 03 00      [10]   34     ld hl, #_entity_array
   0030 22 01 00      [16]   35     ld (_last_elem_ptr), hl
                             36 
   0033 C9            [10]   37 ret
                             38 
   0034                      39 man_entity_new::
                             40 
   0034 21 00 00      [10]   41     ld hl, #_num_entities ;; Incremento el numero de entidades
   0037 34            [11]   42     inc (hl)
                             43     
   0038 2A 01 00      [16]   44     ld hl, (_last_elem_ptr)
   003B 54            [ 4]   45     ld d, h
   003C 5D            [ 4]   46     ld e, l
   003D 01 07 00      [10]   47     ld bc, #sizeof_e ;; cargo una entidad del tamano de una entidad
   0040 09            [11]   48     add hl, bc
   0041 22 01 00      [16]   49     ld (_last_elem_ptr), hl ;;Lo anado al vector
   0044 C9            [10]   50     ret
   0045 C9            [10]   51 ret
                             52 
   0046                      53 entityman_creater::
                             54 
   0046 E5            [11]   55     push hl
   0047 CD 34 00      [17]   56     call man_entity_new ;;Cargo una nueva entidad al vector
                             57 
                             58     ;;ld__ixh_d
                             59     ;;ld__ixl_e
                             60 
   004A E1            [10]   61     pop hl
                             62     
   004B ED B0         [21]   63     ldir 
   004D C9            [10]   64 ret
                             65 
   004E                      66 entityman_create::
                             67     
   004E ED 5B 01 00   [20]   68     ld de, (_last_elem_ptr)
   0052 01 07 00      [10]   69     ld bc, #sizeof_e
   0055 ED B0         [21]   70     ldir
                             71 
   0057 3A 00 00      [13]   72     ld a, (_num_entities)
   005A 3C            [ 4]   73     inc a
   005B 32 00 00      [13]   74     ld (_num_entities), a
                             75 
   005E 2A 01 00      [16]   76     ld hl, (_last_elem_ptr)
   0061 01 07 00      [10]   77     ld bc, #sizeof_e
   0064 09            [11]   78     add hl, bc
   0065 22 01 00      [16]   79     ld (_last_elem_ptr), hl
                             80 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 5.
Hexadecimal [16-Bits]



   0068 C9            [10]   81 ret
